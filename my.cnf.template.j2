[mysql]
user=root
password={{root_password}}
port={{ port }}
prompt="\R:\m:\\s[\d](\l)>"
reconnect
show-warnings

[mysqld]
port={{ port }}
user=mysql
datadir=/db/{{ ansible_hostname }}/data101
tmpdir=/db/{{ ansible_hostname }}/temp
open-files-limit=20000
max-connections={{ max_connections }}

# storage engine options
archive=OFF
blackhole=OFF
federated=OFF
default-storage-engine=innodb
default-tmp-storage-engine=innodb
#disabled-storage-engines=myisam

memlock=ON
key_buffer_size=32M
table_open_cache=8000
table-open-cache-instances=16
back-log=1500
join_buffer_size=32k
sort_buffer_size=32k

# binary log (for incremental backup)
log-bin = /db/{{ ansible_hostname }}/log/mysql-bin
binlog-row-image=MINIMAL
binlog-rows-query-log-events=ON
log-bin-trust-function-creators=TRUE
expire-logs-days=3
max-binlog-size=1G

# character set
character-set-server={{ character_set }}

# crash handling and debugging options
core-file

#security options
#default-password-lifetime=0
#validate_password_policy=0

# date and time handling options
default-time-zone=SYSTEM
explicit-defaults-for-timestamp=ON


# scheduler options
event-scheduler=ON

# performance schema options
performance-schema-consumer-events-transactions-current=ON
performance-schema-consumer-events-transactions-history=ON


# InnoDB options
innodb-autoinc-lock-mode=2
innodb_flush_log_at_trx_commit=1
innodb_flush_method=O_DIRECT_NO_FSYNC
innodb-log-group-home-dir=/db/{{ ansible_hostname }}/log/redo
innodb-log-file-size=1G
innodb-log-files-in-group=6

innodb-log-write-ahead-size=4096
innodb-open-files=2048
innodb-log-buffer-size=64M
innodb-monitor-enable=%
innodb-max-dirty-pages-pct=90
innodb_max_dirty_pages_pct_lwm=10
innodb-print-all-deadlocks=ON
innodb-undo-log-truncate=ON

server-id=1
#innodb-buffer-pool-size= * should be ~80% of available memory *
innodb-buffer-pool-size={{buffer_pool_size}}
innodb-buffer-pool-instances=8
innodb_flush_neighbors=0
#innodb-io-capacity=200
#innodb-io-capacity-max=400

# added by Zohar
socket=/var/lib/mysql/mysql.sock
bulk_insert_buffer_size=500M

# Disabling symbolic-links is recommended to prevent assorted security risks
symbolic-links=0

log-error=/var/log/mysqld.log
pid-file=/var/run/mysqld/mysqld.pid

log_timestamps=SYSTEM
